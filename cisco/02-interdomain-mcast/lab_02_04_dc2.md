# Configuration of DC2
## Interfaces
c-2-d2-pe1
```
interface Loopback0
 ipv4 address 20.0.255.1 255.255.255.254
 ipv6 address fc00:20:0:255::1/128
 no shutdown
!
interface GigabitEthernet0/0/0/0
 ipv4 address 20.0.0.0 255.255.255.254
 ipv6 address fc00:20::0/127
 no shutdown
!
interface GigabitEthernet0/0/0/1
 ipv4 address 20.0.0.2 255.255.255.254
 ipv6 address fc00:20::2/127
 no shutdown
!
interface GigabitEthernet0/0/0/2
 ipv4 address 100.64.0.1 255.255.255.254
 ipv6 address fc00:100:64::1/127
 no shutdown
!
interface GigabitEthernet0/0/0/3
 ipv4 address 100.64.0.5 255.255.255.254
 ipv6 address fc00:100:64::5/127
 no shutdown
!
```

c-2-d2-pe2
```
interface GigabitEthernet0/0/0/0
 ipv4 address 20.0.0.1 255.255.255.254
 ipv6 address fc00:20::1/127
 no shutdown
!
interface GigabitEthernet0/0/0/1
 ipv4 address 20.0.0.4 255.255.255.254
 ipv6 address fc00:20::4/127
 no shutdown
!
interface GigabitEthernet0/0/0/2
 ipv4 address 100.64.0.3 255.255.255.254
 ipv6 address fc00:100:64::3/127
 no shutdown
!
interface GigabitEthernet0/0/0/3
 ipv4 address 100.64.0.7 255.255.255.254
 ipv6 address fc00:100:64::7/127
 no shutdown
!
int lo 0
 ipv4 address 20.0.255.2 255.255.255.254
 ipv6 address fc00:20:0:255::2/128
 no shutdown
!
```

c-2-d2-pe3
```
interface Loopback0
 ipv4 address 20.0.255.3 255.255.255.254
 ipv6 address fc00:20:0:255::3/128
 no shutdown
!
interface GigabitEthernet0/0/0/0
 ipv4 address 20.0.0.6 255.255.255.254
 ipv6 address fc00:20::6/127
 no shutdown
!
interface GigabitEthernet0/0/0/1
 ipv4 address 20.1.0.1 255.255.255.0
 ipv6 address fc00:20:1::1/64
 no shutdown
!
```

c-2-d2-p1
```
interface Loopback0
 ipv4 address 20.0.255.4 255.255.255.254
 ipv6 address fc00:20:0:255::4/128
 no shutdown
!
interface GigabitEthernet0/0/0/0
 ipv4 address 20.0.0.3 255.255.255.254
 ipv6 address fc00:20::3/127
 no shutdown
!
interface GigabitEthernet0/0/0/1
 ipv4 address 20.0.0.5 255.255.255.254
 ipv6 address fc00:20::5/127
 no shutdown
!
interface GigabitEthernet0/0/0/2
 ipv4 address 20.0.0.7 255.255.255.254
 ipv6 address fc00:20::7/127
 no shutdown
!
```

## CDP
All devices:
```
cdp
cdp log adjacency changes
cdp advertise v1
```

c-2-d2-pe1
```
interface GigabitEthernet0/0/0/0
 cdp
!
interface GigabitEthernet0/0/0/1
 cdp
!
interface GigabitEthernet0/0/0/2
 cdp
!
interface GigabitEthernet0/0/0/3
 cdp
!
```

c-2-d2-pe2
```
interface GigabitEthernet0/0/0/0
 cdp
!
interface GigabitEthernet0/0/0/1
 cdp
!
interface GigabitEthernet0/0/0/2
 cdp
!
interface GigabitEthernet0/0/0/2
 cdp
!
```

c-2-d2-pe3
```
interface GigabitEthernet0/0/0/0
 cdp
!
interface GigabitEthernet0/0/0/1
 cdp
!
```

c-2-d2-p1
```
interface GigabitEthernet0/0/0/0
 cdp
!
interface GigabitEthernet0/0/0/1
 cdp
!
interface GigabitEthernet0/0/0/2
 cdp
!
```

## IGP
### ISIS
c-2-d2-pe1
```
router isis code-dc2
 is-type level-2-only
 net 49.0000.0200.0025.5001.00
 log adjacency changes
 address-family ipv4 unicast
  metric-style wide
  ispf
  spf-interval maximum-wait 1000 initial-wait 50 secondary-wait 50
 !
 address-family ipv6 unicast
  metric-style wide
  ispf
  spf-interval maximum-wait 1000 initial-wait 50 secondary-wait 50
 !
 interface Loopback0
  passive
  address-family ipv4 unicast
  !
  address-family ipv6 unicast
  !
 !
 interface GigabitEthernet0/0/0/0
  point-to-point
  address-family ipv4 unicast
  !
  address-family ipv6 unicast
  !
 !
 interface GigabitEthernet0/0/0/1
  point-to-point
  address-family ipv4 unicast
  !
  address-family ipv6 unicast
  !
 !
!         
```

c-2-d2-pe2
```
router isis code-dc2
 is-type level-2-only
 net 49.0000.0200.0025.5002.00
 log adjacency changes
 address-family ipv4 unicast
  metric-style wide
  ispf
  spf-interval maximum-wait 1000 initial-wait 50 secondary-wait 50
 !
 address-family ipv6 unicast
  metric-style wide
  ispf
  spf-interval maximum-wait 1000 initial-wait 50 secondary-wait 50
 !
 interface Loopback0
  passive
  address-family ipv4 unicast
  !
  address-family ipv6 unicast
  !
 !
 interface GigabitEthernet0/0/0/0
  point-to-point
  address-family ipv4 unicast
  !
  address-family ipv6 unicast
  !
 !
 interface GigabitEthernet0/0/0/1
  point-to-point
  address-family ipv4 unicast
  !
  address-family ipv6 unicast
  !
 !
!         
```

c-2-d2-pe3
```
router isis code-dc2
 is-type level-2-only
 net 49.0000.0200.0025.5003.00
 log adjacency changes
 address-family ipv4 unicast
  metric-style wide
  ispf
  spf-interval maximum-wait 1000 initial-wait 50 secondary-wait 50
 !
 address-family ipv6 unicast
  metric-style wide
  ispf
  spf-interval maximum-wait 1000 initial-wait 50 secondary-wait 50
 !
 interface Loopback0
  passive
  address-family ipv4 unicast
  !
  address-family ipv6 unicast
  !
 !
 interface GigabitEthernet0/0/0/0
  point-to-point
  address-family ipv4 unicast
  !
  address-family ipv6 unicast
  !
 !
 interface GigabitEthernet0/0/0/1
  passive
  address-family ipv4 unicast
  !
  address-family ipv6 unicast
  !
 !
!
```

c-2-d2-pe3
```
router isis code-dc2
 is-type level-2-only
 net 49.0000.0200.0025.5004.00
 log adjacency changes
 address-family ipv4 unicast
  metric-style wide
  ispf
  spf-interval maximum-wait 1000 initial-wait 50 secondary-wait 50
 !
 address-family ipv6 unicast
  metric-style wide
  ispf
  spf-interval maximum-wait 1000 initial-wait 50 secondary-wait 50
 !
 interface Loopback0
  passive
  address-family ipv4 unicast
  !
  address-family ipv6 unicast
  !
 !
 interface GigabitEthernet0/0/0/0
  point-to-point
  address-family ipv4 unicast
  !
  address-family ipv6 unicast
  !
 !
 interface GigabitEthernet0/0/0/1
  point-to-point
  address-family ipv4 unicast
  !
  address-family ipv6 unicast
  !
 !
 interface GigabitEthernet0/0/0/2
  point-to-point
  address-family ipv4 unicast
  !
  address-family ipv6 unicast
  !
 !
!
```

#### Authentication
all:
```
key chain KC_ISIS_AUTH
 key 1
  accept-lifetime 00:00:00 january 01 2022 infinite
  key-string DC1_AUTH_KEY
  send-lifetime 00:00:00 january 01 2022 infinite
  cryptographic-algorithm HMAC-SHA-256
 !
!
```

all:
```
router isis code-dc2
 lsp-password keychain KC_ISIS_AUTH
 interface GigabitEthernet0/0/0/0
  hello-password keychain KC_ISIS_AUTH
 !
 interface GigabitEthernet0/0/0/1
  hello-password keychain KC_ISIS_AUTH
 !
 interface GigabitEthernet0/0/0/2
  hello-password keychain KC_ISIS_AUTH
 !
!
```

## Multicasting
### Enable Multcasting for IPv4
All routers:
```
multicast-routing
 address-family ipv4
  interface all enable
 !
!
multicast-routing
!
```

### PIMv4
on pe1 and pe2:
```
ipv4 access-list ACL_IPV4_DENY_PIM_NEIGH
 10 deny ipv4 any any
!
router pim
 address-family ipv4
  log neighbor changes
  interface GigabitEthernet0/0/0/0
   no neighbor-filter
  !
  interface GigabitEthernet0/0/0/2
   bsr-border
   no neighbor-filter
  !
  interface GigabitEthernet0/0/0/3
   bsr-border
   no neighbor-filter
  !
 !
!
```

### PIMv4 - BSR
p1:
```
ipv4 access-list ACL_IPV4_RP_MCAST
 10 permit ipv4 any 237.0.0.0/8
 20 permit ipv4 any 239.0.0.0/8
!
router pim
 address-family ipv4
  log neighbor changes
  bsr candidate-bsr 20.0.255.4 hash-mask-len 30 priority 1
  bsr candidate-rp 20.0.255.4 group-list ACL_IPV4_RP_MCAST priority 192 interval 60
 !
!
```

### PIMv4 BIDIR
All routers:
```
ipv4 access-list ACL_IPV4_RP_MCAST_BIDIR
 10 permit ipv4 any 238.0.0.0/8
!
router pim
 address-family ipv4
  bsr candidate-rp 20.0.255.4 group-list ACL_IPV4_RP_MCAST_BIDIR priority 192 interval 60 bidir
 !
!
```

### Apply Multicast Border
```
ipv4 access-list ACL_IPV4_MCAST_BOUNDARY
 10 permit ipv4 any 237.0.0.0/8
 9999 deny ipv4 any any
!
multicast-routing
 address-family ipv4
  interface GigabitEthernet0/0/0/2
   boundary ACL_IPV4_MCAST_BOUNDARY
  !
  interface GigabitEthernet0/0/0/3
   boundary ACL_IPV4_MCAST_BOUNDARY
  !
 !
!
multicast-routing
!
```

###
PE routers
```
ipv4 access-list ACL_IPV4_NO_PIM
 10 deny pim any any
 9999 permit ipv4 any any
!
interface GigabitEthernet0/0/0/2
 ipv4 access-group ACL_IPV4_NO_PIM ingress
 ipv4 access-group ACL_IPV4_NO_PIM egress
!
interface GigabitEthernet0/0/0/3
 ipv4 access-group ACL_IPV4_NO_PIM ingress
 ipv4 access-group ACL_IPV4_NO_PIM egress
!
```


## BGP
### iBGP
P1
```
router bgp 65002
 bgp router-id 20.0.255.4
 bgp log neighbor changes detail
 address-family ipv4 unicast
  additional-paths receive
  additional-paths send
 !
 af-group AF_IPV4_UNI_65002_RR_CLIENTS address-family ipv4 unicast
  route-reflector-client
 !
 session-group SG_65000_RR_CLIENTS
  remote-as 65002
  advertisement-interval 0
  password clear SUPER_65002_PASS
  update-source Loopback0
 !
 neighbor 20.0.255.1
  use session-group SG_65000_RR_CLIENTS
  address-family ipv4 unicast
   use af-group AF_IPV4_UNI_65002_RR_CLIENTS
  !
 !
 neighbor 20.0.255.2
  use session-group SG_65000_RR_CLIENTS
  address-family ipv4 unicast
   use af-group AF_IPV4_UNI_65002_RR_CLIENTS
  !
 !
 neighbor 20.0.255.3
  use session-group SG_65000_RR_CLIENTS
  address-family ipv4 unicast
   use af-group AF_IPV4_UNI_65002_RR_CLIENTS
  !
 !
!
```

PE1
```
router bgp 65002
 bgp router-id 20.0.255.1
 bgp log neighbor changes detail
 address-family ipv4 unicast
  additional-paths receive
  additional-paths send
 !
 neighbor 20.0.255.2
  remote-as 65002
  advertisement-interval 0
  password clear SUPER_65002_PASS
  update-source Loopback0
  address-family ipv4 unicast
   next-hop-self
  !
 !
 neighbor 100.64.0.0
  remote-as 65001
  advertisement-interval 0
  password clear INTER_ASS
  address-family ipv4 unicast
    route-policy RP_IPV4_AS_65000_PERMIT out
    route-policy RP_PERMIT_ANY in
  !
 !
!
```

PE2
```
router bgp 65002
 bgp router-id 20.0.255.2
 bgp log neighbor changes detail
 address-family ipv4 unicast
  additional-paths receive
  additional-paths send
 !
 neighbor 20.0.255.1
  remote-as 65002
  advertisement-interval 0
  password clear SUPER_65002_PASS
  update-source Loopback0
  address-family ipv4 unicast
   next-hop-self
  !
 !
 neighbor 100.64.0.2
  remote-as 65001
  advertisement-interval 0
  password clear INTER_ASS
  address-family ipv4 unicast
    route-policy RP_IPV4_AS_65000_PERMIT out
    route-policy RP_PERMIT_ANY in
  !
 !
!
```

Both PE
```
prefix-set PS_IPV4_AS_65002_ROUTES
  20.0.0.0/8 le 24
end-set
!
route-policy RP_PERMIT_ANY
  pass
end-policy
!
route-policy RP_IPV4_AS_65000_PERMIT
  if destination in PS_IPV4_AS_65002_ROUTES then
    done
  else
    drop
  endif
end-policy
!
router bgp 65002
 address-family ipv4 unicast
  redistribute isis code-dc2 route-policy RP_IPV4_AS_65000_PERMIT
  aggregate-address 20.0.0.0/8 summary-only
 !
!
```

Both PE
```
route-policy RP_BGP_TO_ISIS
  if destination in PS_IPV4_AS_65002_ROUTES then
    drop
  else
    done
  endif
end-policy
!
router isis code-dc2
 address-family ipv4 unicast
  redistribute bgp 65002 level-2 route-policy RP_BGP_TO_ISIS
 !
!
```

### MSDP
on P1
```
router msdp
 connect-source Loopback0
 originator-id Loopback0
 default-peer 10.0.255.5
 !
 peer 10.0.255.5
  password clear IIIAAABBB
  description RP_AS65001
  keepalive 5 15
 !
!
```

on P1
```
ipv4 access-list ACL_IPV4_INTERDOMAIN_MCAST
 10 permit ipv4 any 237.0.0.0/8
 9999 deny ipv4 any any
!
router msdp
 sa-filter in list ACL_IPV4_INTERDOMAIN_MCAST
 sa-filter out list ACL_IPV4_INTERDOMAIN_MCAST
!
```